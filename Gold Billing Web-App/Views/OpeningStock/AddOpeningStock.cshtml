@model Gold_Billing_Web_App.Models.ViewModels.OpeningStockViewModel

<div class="card shadow-lg border-0">
    <div class="card-body p-4">
        <h3 class="mt-4 mb-4 text-center text-uppercase fw-bold" style="color: #2c3e50; letter-spacing: 1px;">@(ViewBag.IsExisting ? "Edit Opening Stock" : "Add Opening Stock")</h3>

        <form id="openingStockForm" asp-action="AddOpeningStock" method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken() <!-- Simplified, already correct -->
            <input type="hidden" asp-for="UserId" />

            <div class="row mb-3">
                <div class="col-md-4">
                    <label asp-for="BillNo" class="form-label fw-bold">Bill No</label>
                    <input asp-for="BillNo" class="form-control" readonly />
                </div>
                <div class="col-md-4">
                    <label asp-for="Date" class="form-label fw-bold">Date</label>
                    <input asp-for="Date" class="form-control" type="date" />
                    <span asp-validation-for="Date" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="Narration" class="form-label fw-bold">Narration</label>
                    <textarea asp-for="Narration" id="Narration" class="form-control"></textarea>
                </div>
            </div>

            <div class="table-responsive rounded-3 shadow-sm">
                <table id="openingStockTable" class="table table-striped table-hover table-bordered mb-0">
                    <thead style="background: linear-gradient(135deg, black, #2c3e50); color: white;">
                        <tr class="text-center">
                            <th>Item</th>
                            <th>Pc</th>
                            <th>Gross Wt.</th>
                            <th>Less</th>
                            <th>Net Wt.</th>
                            <th>Tunch</th>
                            <th>Wastage</th>
                            <th>T.W.</th>
                            <th>Rate</th>
                            <th>Fine</th>
                            <th>Amount</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.Items.Count; i++)
                        {
                            <tr>
                                <td>
                                    <input type="hidden" asp-for="Items[i].Id" />
                                    <input type="hidden" asp-for="Items[i].UserId" />
                                    <select asp-for="Items[i].ItemId" class="form-select item-select" data-index="@i">
                                        <option value="0">Select Item</option>
                                        @foreach (var item in ViewBag.ItemDropDown as List<ItemDropDownModel>)
                                        {
                                            <option value="@item.Id" data-group="@item.GroupName" selected="@(Model.Items[i].ItemId == item.Id)">@item.ItemName</option>
                                        }
                                    </select>
                                    <span asp-validation-for="Items[i].ItemId" class="text-danger"></span>
                                </td>
                                <td><input asp-for="Items[i].Pc" class="form-control pc-input text-center" /></td>
                                <td><input asp-for="Items[i].Weight" class="form-control weight-input text-center" /></td>
                                <td><input asp-for="Items[i].Less" class="form-control less-input text-center" /></td>
                                <td><input asp-for="Items[i].NetWt" class="form-control netwt-input text-center" readonly /></td>
                                <td><input asp-for="Items[i].Tunch" class="form-control tunch-input text-center" /></td>
                                <td><input asp-for="Items[i].Wastage" class="form-control wastage-input text-center" /></td>
                                <td><input asp-for="Items[i].TW" class="form-control tw-input text-center" readonly /></td>
                                <td><input asp-for="Items[i].Rate" class="form-control rate-input text-center" /></td>
                                <td><input asp-for="Items[i].Fine" class="form-control fine-input text-center" readonly /></td>
                                <td><input asp-for="Items[i].Amount" class="form-control amount-input text-center" readonly /></td>
                                <td class="text-center"><button type="button" class="btn btn-danger remove-row-btn">Remove</button></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="mt-4 text-center">
                <button type="button" class="btn btn-gradient btn-success shadow-sm add-row-btn">Add Row</button>
                <button type="submit" class="btn btn-gradient btn-primary shadow-sm">Save</button>
                @if (ViewBag.IsExisting)
                {
                    <button type="button" id="deleteBillBtn" class="btn btn-gradient btn-danger shadow-sm" data-bill-no="@Model.BillNo">Delete</button>
                }
                <a href="@Url.Action("ViewStock", "OpeningStock")" class="btn btn-gradient btn-secondary shadow-sm">Back</a>
            </div>
        </form>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="~/js/openingStock.js"></script>
<script>
    const addOpeningStockUrl = '@Url.Action("AddOpeningStock", "OpeningStock")';
    const deleteOpeningStockUrl = '@Url.Action("DeleteOpeningStock", "OpeningStock")';
    setupFormSubmission(addOpeningStockUrl, deleteOpeningStockUrl);
    setupEventListeners();
</script>
<script src="https://cdn.tiny.cloud/1/[your-api-key]/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
    tinymce.init({
        selector: '#Narration',
        height: 200,
        plugins: 'link lists',
        toolbar: 'bold italic | bullist numlist'
    });
</script>

<style>
    .btn-gradient {
        background: linear-gradient(135deg, #3498db, #2980b9);
        border: none;
        padding: 10px 20px;
        transition: all 0.3s ease;
    }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

    .btn-danger {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    .btn-success {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
    }
</style>